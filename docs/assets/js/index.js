"use strict";let selectedImages={};const previewListElement=document.getElementById("preview-list"),uploadedList={container:document.getElementById("uploaded-list-container"),list:document.getElementById("uploaded-list"),closeButton:document.getElementById("close-uploaded-list-button")},uploadingProgressElement=document.getElementById("uploading-progress");let isUploading=!1;function addPreviewCard(e){let t=document.createElement("div");t.classList.add("card"),t.id="selectedImage:"+e,previewListElement.appendChild(t);let d=document.createElement("header");d.classList.add("card-header"),t.appendChild(d);let a=document.createElement("p");a.classList.add("card-header-title"),a.innerText=selectedImages[e].file.name,d.appendChild(a);let l=document.createElement("div");l.classList.add("card-image"),t.appendChild(l);let n=document.createElement("figure");n.classList.add("image"),l.appendChild(n);let i=document.createElement("img");i.src=URL.createObjectURL(selectedImages[e].file),n.appendChild(i);let s=document.createElement("div");s.classList.add("card-content"),t.appendChild(s);let c=document.createElement("div");c.classList.add("field"),s.appendChild(c);let o=document.createElement("div");o.classList.add("control","is-expanded"),c.appendChild(o);let r=document.createElement("input");r.type="text",r.id="iamages-description:"+e,r.classList.add("input","iamages-upload-disable"),r.placeholder="No description yet.",r.onchange=function(t){selectedImages[e].description=t.target.value},o.appendChild(r),c.appendChild(document.createElement("br"));let m=document.createElement("div");m.classList.add("control"),c.appendChild(m);let p=document.createElement("input");p.type="checkbox",p.autocomplete="off",p.id="iamages-isNSFW:"+e,p.classList.add("switch","is-danger","is-rounded","iamages-upload-disable"),p.onchange=function(t){selectedImages[e].isNSFW=t.target.checked},m.appendChild(p);let u=document.createElement("label");u.htmlFor="iamages-isNSFW:"+e,u.innerText="NSFW",m.appendChild(u),c.appendChild(document.createElement("br"));let g=document.createElement("div");g.classList.add("control"),c.appendChild(g);let h=document.createElement("input");h.type="checkbox",h.autocomplete="off",h.id="iamages-isExcludeSearch:"+e,h.classList.add("switch","is-danger","is-rounded","iamages-upload-disable"),h.onchange=function(t){selectedImages[e].isExcludeSearch=t.target.checked},g.appendChild(h);let E=document.createElement("label");E.htmlFor="iamages-isExcludeSearch:"+e,E.innerText="Exclude from search",g.appendChild(E);let f=document.createElement("footer");f.classList.add("card-footer"),t.appendChild(f);let L=document.createElement("a");L.classList.add("card-footer-item","is-unselectable"),L.innerText="Remove from queue",L.onclick=function(){removePreviewCard(e)},f.appendChild(L),previewListElement.append(document.createElement("br"))}function removePreviewCard(e){isUploading||(delete selectedImages[e],document.getElementById("selectedImage:"+e).remove())}function addUploadedCard(e,t){let d=document.createElement("div");d.classList.add("card"),uploadedList.list.appendChild(d);let a=document.createElement("header");a.classList.add("card-header"),d.appendChild(a);let l=document.createElement("p");l.classList.add("card-header-title"),l.innerText=t,a.appendChild(l);let n=document.createElement("div");n.classList.add("card-image"),d.appendChild(n);let i=document.createElement("figure");i.classList.add("image"),n.appendChild(i);let s=document.createElement("img");s.src="https://iamages.uber.space/iamages/api/thumb/"+e,i.appendChild(s);let c=document.createElement("footer");c.classList.add("card-footer"),d.appendChild(c);let o=document.createElement("a");o.classList.add("card-footer-item","is-unselectable"),o.innerText="Link to embed",o.target="_blank",o.href="https://iamages.uber.space/iamages/api/embed/"+e,c.appendChild(o),uploadedList.list.appendChild(document.createElement("br"))}document.getElementById("select-images-input").onchange=function(e){for(const t of e.target.files){const e=uuidv4();selectedImages[e]={description:"",isNSFW:!1,isExcludeSearch:!1,file:t},addPreviewCard(e)}},document.getElementById("upload-images-button").onclick=function(e){function t(e){console.error(e),bulmaToast.toast({message:e,type:"is-danger"})}isUploading=!0;for(let e of document.getElementsByClassName("iamages-upload-disable"))e.disabled=!0;uploadedList.list.innerHTML="",uploadedList.container.classList.remove("is-hidden");const d=Object.keys(selectedImages);let a=0;for(const e of d){a++;const l=new FileReader;l.readAsDataURL(selectedImages[e].file),l.onload=function(){fetch("https://iamages.uber.space/iamages/api/upload",{method:"PUT",keepalive:!0,body:JSON.stringify({FileDescription:selectedImages[e].description,FileNSFW:selectedImages[e].isNSFW,FileData:l.result.split(",")[1],FileExcludeSearch:selectedImages[e].isExcludeSearch})}).then((function(e){if(!e.ok)throw new Error("Network response was not OK!");return e.json()})).then((function(t){const d=selectedImages[e].description;removePreviewCard(e),addUploadedCard(t.FileID,d)})).catch((function(e){t(e)}))},l.onerror=function(e){t(e)},uploadingProgressElement.value=a/d.length*100}setTimeout((function(){uploadingProgressElement.value=0}),3e3);for(let e of document.getElementsByClassName("iamages-upload-disable"))e.disabled=!1;isUploading=!1},uploadedList.closeButton.onclick=function(){uploadedList.container.classList.add("is-hidden")};